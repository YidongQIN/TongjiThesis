% !TeX root = ../Main/thesis.tex
\NeedsTeXFormat{LaTeX2e}[1999/12/01]
\ProvidesPackage{tongjithesis}[2019/06/21 3 put any packages you would like to use here]

% 定义常用的名词
\newcommand{\chn}{中华人民共和国}

% 设置各级列表的样式，依赖于 enumitem 宏包
\setlist[1]{labelindent=\parindent,leftmargin=\parindent}
\setlist[2]{labelindent=1em,leftmargin=\parindent}
\setlist[3]{labelindent=1em,leftmargin=\parindent}
\setlist[enumerate,1]{label=(\arabic*), ref = \arabic*}
\setlist[enumerate,2]{label=(\alph*), ref=\theenumi.\alph*}
\setlist[enumerate,3]{label=(\roman*),ref=\theenumii.\roman*}
\setlist[itemize,1]{label=$\bullet$}
\setlist[itemize,2]{label=$\circ$}
\setlist[itemize,3]{label=\tiny$\blacksquare$}
\setlist[description]{font=\heiti}
\newlist{inlinecn}{enumerate*}{1}
\setlist[inlinecn,1]{label=\tikzcircnum{\arabic*}}
\setlist[inlinecn,2]{label= 第\chinese{inlinecni}，}
\newlist{inline}{enumerate*}{2}
\setlist[inline,1]{label=(\arabic*)}
\setlist[inline,2]{label=\roman*.}

% 颜色，主要用于代码展示
\RequirePackage{xcolor}
\definecolor{darkred}{rgb}{0.6,0.0,0.0}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{darkgreen}{rgb}{0,0.50,0}
\definecolor{darkblue}{rgb}{0.0,0.0,0.6}
\definecolor{lightblue}{rgb}{0.0,0.42,0.91}
\definecolor{cyan}{rgb}{0.0,0.6,0.6}
\definecolor{orange}{rgb}{0.99,0.48,0.13}
\definecolor{grass}{rgb}{0.18,0.80,0.18}
\definecolor{pink}{rgb}{0.97,0.15,0.45}
\definecolor{gray}{rgb}{0.4,0.4,0.4}
\definecolor{bluegray}{rgb}{0.81,0.86,0.91}
\definecolor{pythonblue}{rgb}{0.168,0.353,0.514}

% 算法环境 推荐 algorithm2e
\RequirePackage[linesnumbered,lined,boxed,commentsnumbered]{algorithm2e}
\setlength{\algomargin}{2em}
\renewcommand{\algorithmcfname}{算法}
\renewcommand{\listalgorithmcfname}{算法索引}
\SetAlgoCaptionSeparator{.}% caption 的分隔符
\SetAlCapSkip{6bp}% 代码与 caption 的竖向间距
\SetNlSty{small}{}{.}
\SetNlSkip{0.5em}
\SetAlFnt{\small\ttfamily}

% 代码展示
\RequirePackage{listings}
% General Settings
\lstset{
  float=htbp,
  breaklines=true,
  frame=single,
  aboveskip={12bp \@plus2pt \@minus2pt},
  belowskip={12bp \@plus2pt \@minus2pt},
  captionpos=b,
  abovecaptionskip=0bp,
  belowcaptionskip=0bp,
  escapeinside={\%*}{*)},
  numbers=left,
  numberstyle=\tiny\color{gray},
  tabsize=2,
}
% Tongji Thesis LaTeX syntex
\lstdefinelanguage{TongjiLaTeX}[LaTeX]{TeX}{
  morekeywords={,
    songti,
    fangsong,
    heiti,
    kaiti,
    lishu,%
    chuhao,
    xiaochu,
    yihao,
    xiaoyi,
    erhao,
    xiaoer,
    sanhao,
    xiaosan,
    sihao,
    banxiaosi,
    xiaosi,
    dawu,
    wuhao,
    xiaowu,
    liuhao,
    xiaoliu,
    qihao,
    bahao,
  },
  morekeywords=[2]{,
    degree,
    bibtype,
    degreetype,
    titlenum,
    electronic,
    secret,
    raggedbottom,
    footnotenum,
  },% cls Options
  morekeywords=[3]{,
    tongji@chapter,
    makecover,
    makedeclarepage,
    makeauthorizationpage,
    makeabstract,
  },
  emph={,
    tongji@ch@name@abstract,
    tongji@chinesekeywords@separator,
    tongji@en@name@abstract,
    tongji@englishkeywords@separator,
    tongji@ch@name@denotation,
    tongji@ch@name@ackn,
    tongji@ch@name@resume,
    tongji@ch@name@school,
    tongji@en@name@school,
    tongji@secretlevel,
    tongji@secretyear,
    tongji@secretlevel@inner,
    tongji@secret@title,
    tongji@secretlevel,
    tongji@secretyear,
    tongji@ch@type@apply,
    tongji@en@type@apply,
    tongji@ch@type@academic,
    tongji@ch@type@profession,
    tongji@ch@type@equaled,
    tongji@ch@flag@electronic,
    ch@degree,
    en@degree,
    tongji@ch@name@authorization,
    tongji@ch@text@authorization,
    tongji@ch@name@declare,
    tongji@ch@text@declare,
    tongji@ch@label@sign,
    tongji@ch@date@sign,
  },
}
% Python Listings syntax and styles
\lstdefinelanguage{PythonPlus}[]{Python}{% prefined Python sty is not complete
  morekeywords=[1]{,as,assert,nonlocal,with,yield,self,True,False,None,} % Python builtin
  morekeywords=[2]{,__init__,__add__,__mul__,__div__,__sub__,__call__,__getitem__,__setitem__,__eq__,__ne__,__nonzero__,__rmul__,__radd__,__repr__,__str__,__get__,__truediv__,__pow__,__name__,__future__,__all__,}, % magic methods
  morekeywords=[3]{,object,type,isinstance,copy,deepcopy,zip,enumerate,reversed,list,set,len,dict,tuple,range,xrange,append,execfile,real,imag,reduce,str,repr,}, % common functions
  morekeywords=[4]{,Exception,NameError,IndexError,SyntaxError,TypeError,ValueError,OverflowError,ZeroDivisionError,}, % errors
  morekeywords=[5]{,ode,fsolve,sqrt,exp,sin,cos,arctan,arctan2,arccos,pi, array,norm,solve,dot,arange,isscalar,max,sum,flatten,shape,reshape,find,any,all,abs,plot,linspace,legend,quad,polyval,polyfit,hstack,concatenate,vstack,column_stack,empty,zeros,ones,rand,vander,grid,pcolor,eig,eigs,eigvals,svd,qr,tan,det,logspace,roll,min,mean,cumsum,cumprod,diff,vectorize,lstsq,cla,eye,xlabel,ylabel,squeeze,},% numpy / math
}
\lstdefinelanguage{PyBrIM}[]{PythonPlus}{% extend Python with user-defined keywords
  emph={d,E,a,Fc28,Fy,Fu,D,des,supplier,Material,Rectangle,PyELMT}, % add word you want to highlight
  }
% XML syntax and styles (To replace the predefined Listings.XML, which is preliminary)
\lstdefinelanguage{XML}{
  % tag is identifier
  moredelim=[s][keywordstyle]{\ }{=},% attribute's key
  morestring=[s]{"}{"},% attribute's value
  morestring=[s][]{>}{<},% text in elements
  morecomment=[s]{?}{?},
  morecomment=[s]{!--}{--},
  morecomment=[l]{!DOCTYPE},
}
% OpenBrIM ParamML Listings syntax
\lstdefinelanguage{ParamML}[]{XML}{
  morekeywords={X,Y,Z,Rx,Ry,Rz,Tx,Ty,Tz,C,R,},
  morekeywords={Node1,Node2,Node3,Node4,Factor,Case,},
  morekeywords={N,V,T,Type,D,Extends,Role,UT,UC,},
  morekeywords={Lng,Lat,Elev,P1,P2,P3,},
}
\lstdefinelanguage{OBrIM_ParamML}{% combination of ParamML (Language) and OpenBrIM (APP style)
  morekeywords={X,Y,Z,Rx,Ry,Rz,Tx,Ty,Tz,C,R,},
  morekeywords={Node1,Node2,Node3,Node4,Factor,Case,},
  morekeywords={N,V,T,Type,D,Extends,Role,UT,UC,},
  morekeywords={Lng,Lat,Elev,P1,P2,P3,},
  moredelim=[s][keywordstyle]{\ }{=},% attribute's key
  morestring=[s][\color{blue}]{"}{"},
  morestring=[s][\color{black}]{>}{<},
  morecomment=[s][\color{green}\itshape]{!--}{--},
  basicstyle=\small\ttfamily,
  backgroundcolor=\color{white},
  identifierstyle=\color{darkred}\bfseries,
  keywordstyle=\color{red},
  showstringspaces=false,
}
% EXPRESS-G syntax and styles
\lstdefinelanguage{EXPRESS}{
  morekeywords=[1]{,SCHEMA,END_SCHEMA,ENTITY,END_ENTITY,},
  morekeywords=[2]{,STRING,BINARY,LOGICAL,BOOLEAN,NUMBER,INTEGER,REAL,LIST,},
  emph={,OPTIONAL,SUBTYPE,SUPERTYPE,OF,DERIVE,WHERE,},
  morestring=[s]{\ \ }{:\ },% attribute's key
  morecomment=[s]{--}{;},
  showstringspaces=false,
}
% Listings styles
\lstdefinestyle{monocolor}{% black and white
  backgroundcolor=\color{white},
  basicstyle=\small\ttfamily,
  showstringspaces=false,
}
\lstdefinestyle{colored}{% basic color theme, works without Package color
  backgroundcolor=\color{white},
  basicstyle=\small\ttfamily,
  commentstyle=\color{green}\itshape,% may use darkgreen for better visual effects
  keywordstyle=\color{blue}\bfseries\itshape,
  stringstyle=\color{red},
  showstringspaces=false,
}
\lstdefinestyle{colorEX}{% more colorful style
  basicstyle=\small\ttfamily,
  backgroundcolor=\color{white},
  commentstyle=\color{darkgreen}\slshape,
  keywordstyle=\color{darkblue}\bfseries\itshape,
  keywordstyle=[2]\color{blue}\bfseries,
  keywordstyle=[3]\color{grass},
  keywordstyle=[4]\color{red},
  keywordstyle=[5]\color{orange},
  stringstyle=\color{darkred},
  emphstyle=\color{pink}\underbar,
  showstringspaces=false,
}
% XML in Firefox
\lstdefinestyle{Firefox_XML}{
  basicstyle=\small\ttfamily,
  backgroundcolor=\color{white},
  commentstyle=\itshape\color{darkgreen},
  identifierstyle=\bfseries\color{darkred},% tag name
  keywordstyle=\bfseries\color{red},% attribute's key
  stringstyle=\color{blue},% attribute's value
  % text style is remained to black
  showstringspaces=false,
}
% OpenBrIM App Platform Listings styles
\lstdefinestyle{OpenBrIM}{
  basicstyle=\small\ttfamily,
  backgroundcolor=\color{white},
  commentstyle=\color{green}\itshape,
  identifierstyle=\bfseries\color{darkred},
  keywordstyle=\color{red},
  stringstyle=\color{blue},
  showstringspaces=false,
}
% settings of `list of Listings'
\renewcommand{\lstlistingname}{代码}% 原"Listing"改为"代码片段"
\renewcommand{\lstlistlistingname}{代码索引}
\renewcommand\l@lstlisting[2]{% 代码索引的对齐样式
  \@dottedtocline{1}{0em}{2em}{\lstlistingname~#1}{#2}}
\newcommand\lisfoflistings{% 需要手动删除冗余的“代码片段”电子书签
  \lstlistoflistings
  \addcontentsline{toc}{chapter}{\lstlistlistingname}
}
\NewDocumentCommand{\listofcode}{s}{
  \IfBooleanTF#1{
    \tongji@chapter*[]{\lstlistlistingname}[\wuhao\songti\tongji@ch@name@school~\tongji@ch@type@apply~\lstlistlistingname]
    \@starttoc{lol}
    \clearpage
  }{
    \tongji@chapter*{\lstlistlistingname}[\wuhao\songti\tongji@ch@name@school~\tongji@ch@type@apply~\lstlistlistingname]
    \@starttoc{lol}
    \clearpage
  }
}

% 处理数学公式中的黑斜体的宏包
%\RequirePackage{bm}
% 不同于 \mathcal 或 \mathfrak 的英文花体字体
%\RequirePackage{mathrsfs}

% 浮动对象的位置控制
\RequirePackage{float} % 可以使用 [H] 强制将浮动对象放到这里
\RequirePackage[section]{placeins} % 提供\FloatBarrier 命令使所有未处理的浮动图形立即被处理。

% \RequirePackage{wrapfig} % 图文绕排
% \RequirePackage{floatflt} % 图文绕排

% 横置内容的页面
\RequirePackage{pdflscape}% 横置内容的页面并旋转为适合阅读的方向
% \RequirePackage{lscape}% 产生横置内容的页面
% \RequirePackage{rotating} % 功能相似于 lscape

% 辅助控制浮动体边距
% \RequirePackage{fullwidth} % 提供一个用于放置浮动体的环境，方便进行上下左右的边距控制
% \RequirePackage{tcolorbox} % 彩色盒子，但也可以用于浮动体控制

% 表格内部换行
\RequirePackage{multirow}% 表格中支持跨多行
\newcommand{\tabincell}[2]{% 两个参数是 {对齐方式}{单元格内容}
  \begin{tabular}{@{}#1@{}}#2\end{tabular}}

% array宏包定义三种新的column对齐格式，允许使用L C R的带长度的表格列
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

% 固定宽度的表格
\RequirePackage{tabularx}% 定义 tabularx 的三种新的列对齐模式
\newcolumntype{a}[1]{>{\raggedright\arraybackslash\hsize=#1\hsize\linewidth=\hsize}X}% 左对齐
\newcolumntype{s}[1]{>{\centering\arraybackslash\hsize=#1\hsize\linewidth=\hsize}X}% 居中
\newcolumntype{d}[1]{>{\raggedleft\arraybackslash\hsize=#1\hsize\linewidth=\hsize}X}% 右对齐

% 表格中的反斜线
\RequirePackage{diagbox}% 表格中的反斜线
\RequirePackage{slashbox}% 表格中的反斜线
\RequirePackage{dcolumn}% 表格中数字按小数点对齐
\newcolumntype{i}[1]{D{.}{.}{#1}}% 接受一个整数控制小数点后位数，负数则居中

% 长表格跨页 \pkg{longtable} \pkg{supertabular} 二选一即可
\RequirePackage{longtable}
% longtable 的 default font size
\let\tongji@LT@array\LT@array
\def\LT@array{\wuhao[1.5]\tongji@LT@array}
\RequirePackage{supertabular}

% 简单三线表推荐用 \cs{hlinewd}% 被 booktabs 代替故取消
% \def\hlinewd#1{% 参数是厚度
%   \noalign{\ifnum0=`}\fi\hrule \@height #1 \futurelet\reserved@a\@xhline}

% 下划线
\RequirePackage[normalem]{ulem}
\RequirePackage{xeCJKfntef}% 汉字下划线、波浪线、加点等标记

% 彩色展示网页
\newcommand{\colorurl}[2][darkblue]{{\color{#1}\ttfamily<\uline{\url{#2}}>}}

% 原样抄写加引号% 不用 \verb 因其不能断行
\newcommand{\tvt}[1]{“\texttt{#1}”}% quoTation marks
% 原样抄写加小括号
\newcommand{\pvp}[1]{（\texttt{#1}）}% Parentheses

% 交叉引用的命令
\newcommand*{\reftab}[1]{\tablename~\ref{#1}}
\newcommand*{\reffig}[1]{\figurename~\ref{#1}}
\newcommand*{\refalg}[1]{\algorithmcfname~\ref{#1}}
\newcommand*{\reflst}[1]{\lstlistingname~\ref{#1}}
\newcommand*{\refequ}[1]{\equationname（\ref{#1}）}
\newcommand*{\refsec}[1]{第~\ref{#1}~节}
\newcommand*{\refcha}[1]{第~\ref{#1}~章}

% 定义破折号
\newcommand{\pozhehao}{\kern0.3ex\rule[0.8ex]{2em}{0.1ex}\kern0.3ex}

% 多级公式输入时修改分子分母字母大小
\newcommand{\FRAC}[2]{\displaystyle\frac{#1}{#2}}

% 脚注美化 https://en.wikibooks.org/wiki/LaTeX/Footnotes_and_Margin_Notes
% 脚注按页编号
\iftongji@raggedbottom
  \RequirePackage[bottom,perpage,hang]{footmisc}% \raggedbottom
\else
  \RequirePackage[perpage,hang]{footmisc}
\fi
% 定义脚注用的带圈数字
\def\tongji@ftntnum#1{%
  \ifnum\value{#1}>9% 脚注数字最多处理到 9
    \ClassError{tongjithesis}{Too many footnotes in this page.}{Keep footnote less than 10.}
  \fi
  \iftongji@pifont
    \circlerm{#1}% 采用 Pifont 的衬线数字、图形较小
  \else\iftongji@circle
    \tikzcircnum{\arabic{#1}}% 采用 Tikz 在外侧绘制圆形
  \else\iftongji@normal
    \footnotesize\arabic{#1}% 原始类型
  \fi
  \fi
  \fi
}
% 取代脚注编号
\renewcommand{\thefootnote}{\tongji@ftntnum{footnote}}
\renewcommand{\thempfootnote}{\tongji@ftntnum{mpfootnote}}% minipage footnote
% 定义脚注分割线
\def\footnoterule{\vspace{-3pt}\hrule\@width0.3\textwidth\@height0.4\p@\vspace{2.6pt}}
\let\tongji@footnotesize\footnotesize
% 字号（宋体小五），以及悬挂缩进（1.5字符）。
\renewcommand\footnotesize{\tongji@footnotesize\xiaowu[1.5]}
\footnotemargin1.5em\relax
% \cs{@makefnmark} 默认是上标样式，而在脚注部分要求为正文大小。
% 利用\cs{patchcmd}动态调整 \cs{@makefnmark} 的定义
\let\tongji@makefnmark\@makefnmark
\def\tongji@@makefnmark{\hbox{{\normalfont\@thefnmark}}}
\pretocmd{\@makefntext}{\let\@makefnmark\tongji@@makefnmark}{}{}
\apptocmd{\@makefntext}{\let\@makefnmark\tongji@makefnmark}{}{}

\endinput
%% End of file `tongjithesis.sty'.
